<!DOCTYPE html>
<html>
<head>
    <style>
        body { background: #000; color: #fff; margin: 0; overflow: hidden; font-family: sans-serif; }
        #clock { display: flex; height: 100vh; justify-content: center; align-items: center; font-size: 25vw; color: #555; }
        #player { display: none; height: 100vh; position: relative; }
        #bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; filter: blur(30px) brightness(0.4); z-index: 1; }
        #content { position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        #art { width: 50vh; height: 50vh; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 0 40px rgba(0,0,0,0.8); }
        h1 { margin: 10px; font-size: 5vh; }
        h2 { margin: 0; font-size: 3vh; color: #ccc; }
    </style>
</head>
<body>
    <div id="clock">00:00</div>
    <div id="player">
        <div id="bg"></div>
        <div id="content">
            <img id="art" src="">
            <h1 id="title">Loading...</h1>
            <h2 id="artist">...</h2>
        </div>
    </div>

    <script>
        function clock() {
            const d = new Date();
            document.getElementById('clock').innerText = 
                String(d.getHours()).padStart(2,'0') + ":" + String(d.getMinutes()).padStart(2,'0');
        }
        setInterval(clock, 1000);
        clock();

        async function update() {
            try {
                // Direkte forespørgsel til Plexamp på localhost
                const res = await fetch('http://localhost:32500/player/timeline/poll?wait=0');
                const text = await res.text();

                if (text.includes('state="playing"')) {
                    document.getElementById('clock').style.display = 'none';
                    document.getElementById('player').style.display = 'block';

                    // Simpel udtrækning af data
                    const title = (text.match(/title="([^"]+)"/) || [])[1] || "";
                    const artist = (text.match(/grandparentTitle="([^"]+)"/) || text.match(/parentTitle="([^"]+)"/) || [])[1] || "";
                    const thumb = (text.match(/thumb="([^"]+)"/) || [])[1] || "";

                    document.getElementById('title').innerText = title;
                    document.getElementById('artist').innerText = artist;
                    
                    if (thumb) {
                        const url = 'http://localhost:32500' + thumb;
                        if (document.getElementById('art').src !== url) {
                            document.getElementById('art').src = url;
                            document.getElementById('bg').style.backgroundImage = `url('${url}')`;
                        }
                    }
                } else {
                    document.getElementById('clock').style.display = 'flex';
                    document.getElementById('player').style.display = 'none';
                }
            } catch (e) {
                // Ved fejl eller stop vis ur
                document.getElementById('clock').style.display = 'flex';
                document.getElementById('player').style.display = 'none';
            }
        }
        setInterval(update, 1000);
    </script>
</body>
</html>
